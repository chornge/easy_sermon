<!DOCTYPE html>
<html>
  <head>
    <title>Easy-Sermon</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 50px;
      }
      .verse {
        margin: 10px;
        padding: 10px;
        border: 4px solid #ccc;
        display: inline-block;
        cursor: pointer;
      }

      /* new verses: red blink */
      @keyframes blink-red {
        0%,
        100% {
          border-color: red;
        }
        50% {
          border-color: transparent;
        }
      }
      .new {
        animation: blink-red 0.4s ease-in-out;
      }

      /* moved‚Äêlater verses: green blink */
      @keyframes blink-green {
        0%,
        100% {
          border-color: green;
        }
        50% {
          border-color: transparent;
        }
      }
      .moved {
        animation: blink-green 0.4s ease-in-out;
      }
    </style>
  </head>
  <body>
    <h2>Pro-Sermon-Presenter (PSP)</h2>
    <p>Click on any passage to auto-copy to clipboard</p>
    <div id="verses">
      {% for verse in verses %}
      <div class="verse" onclick="copyToClipboard('{{ verse }}')">
        {{ verse }}
      </div>
      {% endfor %}
    </div>

    <script>
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .catch((err) => alert("Copy failed: " + err));
      }

      (function () {
        const seenKey = "seenVerses";
        const orderKey = "verseOrder";

        // current verses in DOM order
        const elems = Array.from(document.querySelectorAll("#verses .verse"));
        const current = elems.map((e) => e.textContent.trim());

        // previous data
        const seen = JSON.parse(localStorage.getItem(seenKey) || "[]");
        const oldOrder = JSON.parse(localStorage.getItem(orderKey) || "[]");

        elems.forEach((el, i) => {
          const v = el.textContent.trim();

          if (!seen.includes(v)) {
            // brand new verse
            el.classList.add("new");
          } else {
            // already seen verse
            const oldIndex = oldOrder.indexOf(v);
            if (oldIndex !== -1 && i > oldIndex) {
              el.classList.add("moved");
            }
          }
        });

        // persist updated seen & order
        const updatedSeen = Array.from(new Set(seen.concat(current)));
        localStorage.setItem(seenKey, JSON.stringify(updatedSeen));
        localStorage.setItem(orderKey, JSON.stringify(current));
      })();

      // auto-refresh every second
      setInterval(() => window.location.reload(), 1200);
    </script>
  </body>
</html>
